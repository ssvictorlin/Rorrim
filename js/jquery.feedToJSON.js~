//jQuery extension to fetch an rss feed and return it as json via YQL
//created by dboz@airshp.com
(function($) {
  
	$.extend({
		feedToJson: function(options, callback) {
			if ($.isFunction(options)) {
			  callback = options;
			  options = null;
			}
			options = $.extend($.feedToJson.defaults,options);
			var url = options.yqlURL + options.yqlQS + "'" + encodeURIComponent(options.feed) + "'" + "&_nocache=" + options.cacheBuster;
			return $.getJSON(url, function(data){  
					//console.log(data.query.results);
					data = data.query.results;
					$.isFunction(callback) && callback(data); //allows the callback function to be the only option
					$.isFunction(options.success) && options.success(data);
				}); 
		}
	});
  
  //defaults
  $.feedToJson.defaults = {
  	yqlURL : 'http://query.yahooapis.com/v1/public/yql',  //yql 
  	yqlQS : 'q=select%20title%20from%20rss%20where%20url%3D%22http%3A%2F%2Frss.news.yahoo.com%2Frss%2Ftopstories%22&format=json&diagnostics=true&callback=',  //yql query string
  	feed:'http://rss.news.yahoo.com/rss/topstories', 
  	cachebuster: Math.floor((new Date().getTime()) / 1200 / 1000), //yql caches feeds, so we change the feed url every 20min
  	success:null //success callback 
  }; 
  
})(jQuery);
// eo feedToJson


